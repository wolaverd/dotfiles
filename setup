#!/bin/bash

repo="${0%/*}"
basedir="$HOME"

while IFS= read -r dotfile; do
	name="${dotfile##*/}"

	[[ $name =~ ^vim ]] && basedir="${basedir}/.vim"
	
	[[ ! -d $basedir ]] && {
		mkdir -p "$basedir" || exit 1
	}

	dest="${basedir}/${dotfile##*/}"
	
	if [[ ! -e $dest && -h $dest ]]; then
		rm -f "$dest"  # Remove broken symlink.
	elif [[ -e $dest && ! -h $dest ]]; then
		rm -i "$dest"  # Remove regular file.
	elif [[ -e $dest && -h $dest ]]; then
		continue
	fi

	ln -s "$dotfile" "$dest" || exit "$?"
done < <(find "$repo" -maxdepth 1 -type f ! -regex '^\.\/\(\.git\|setup\).*' \
					-exec readlink -f {} \;)

